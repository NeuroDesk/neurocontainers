name: manual-build

on:
  workflow_dispatch:
    inputs:
      applications:
        description: 'Applications'
        required: true
        type: string

jobs:
  setup-matrix:
    runs-on: ubuntu-22.04
    outputs:
      changed_recipes: ${{ steps.find_changed_recipes.outputs.changed_recipes }}
    steps:
    - name: Find changed recipes
      id: find_changed_recipes
      run: |
        changed_recipes=$(echo "${{ github.event.inputs.applications }}" | tr -d " " | jq -rcR 'split(",")')
        echo "${changed_recipes}"
        echo "changed_recipes=${changed_recipes}" >> $GITHUB_OUTPUT

  build-apps:
    needs: setup-matrix
    uses: ./.github/workflows/build-apps.yml
    with:
      applications: ${{ needs.setup-matrix.outputs.changed_recipes }}
