name: manual-build

on:
  workflow_dispatch:
    inputs:
      applications:
        description: 'Applications'
        required: true
        type: string

jobs:
  applist:
    runs-on: ubuntu-22.04
    outputs:
      apps_to_build: ${{ steps.find_changed_recipes.outputs.changed_recipes }}
    steps:
    - name: Find changed recipes
      id: find_changed_recipes
      run: |
        apps_to_build=$(echo "${{ github.event.inputs.applications }}" | tr -d " " | jq -rcR 'split(",")')
        echo "apps_to_build=${apps_to_build}" >> $GITHUB_OUTPUT

  builder:
    needs: applist
    uses: ./.github/workflows/builder.yml
    with:
      applications: ${{ needs.applist.outputs.apps_to_build }}
